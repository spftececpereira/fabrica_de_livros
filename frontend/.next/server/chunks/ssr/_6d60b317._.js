module.exports=[57554,31010,a=>{"use strict";var b=a.i(25831);function c(a,b){if("function"==typeof a)return a(b);null!=a&&(a.current=b)}function d(...a){return b=>{let d=!1,e=a.map(a=>{let e=c(a,b);return d||"function"!=typeof e||(d=!0),e});if(d)return()=>{for(let b=0;b<e.length;b++){let d=e[b];"function"==typeof d?d():c(a[b],null)}}}}function e(...a){return b.useCallback(d(...a),a)}a.s(["composeRefs",()=>d,"useComposedRefs",()=>e],31010);var f=a.i(73232),g=b.forwardRef((a,c)=>{let{children:d,...e}=a,g=b.Children.toArray(d),i=g.find(j);if(i){let a=i.props.children,d=g.map(c=>c!==i?c:b.Children.count(a)>1?b.Children.only(null):b.isValidElement(a)?a.props.children:null);return(0,f.jsx)(h,{...e,ref:c,children:b.isValidElement(a)?b.cloneElement(a,void 0,d):null})}return(0,f.jsx)(h,{...e,ref:c,children:d})});g.displayName="Slot";var h=b.forwardRef((a,c)=>{let{children:e,...f}=a;if(b.isValidElement(e)){var g;let a,h,i=(g=e,(h=(a=Object.getOwnPropertyDescriptor(g.props,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?g.ref:(h=(a=Object.getOwnPropertyDescriptor(g,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?g.props.ref:g.props.ref||g.ref);return b.cloneElement(e,{...function(a,b){let c={...b};for(let d in b){let e=a[d],f=b[d];/^on[A-Z]/.test(d)?e&&f?c[d]=(...a)=>{f(...a),e(...a)}:e&&(c[d]=e):"style"===d?c[d]={...e,...f}:"className"===d&&(c[d]=[e,f].filter(Boolean).join(" "))}return{...a,...c}}(f,e.props),ref:c?d(c,i):i})}return b.Children.count(e)>1?b.Children.only(null):null});h.displayName="SlotClone";var i=({children:a})=>(0,f.jsx)(f.Fragment,{children:a});function j(a){return b.isValidElement(a)&&a.type===i}a.s(["Slot",()=>g,"Slottable",()=>i],57554)},4252,a=>{"use strict";var b=a.i(25831),c=a.i(35812),d=a.i(57554),e=a.i(73232),f=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"].reduce((a,c)=>{let f=b.forwardRef((a,b)=>{let{asChild:f,...g}=a,h=f?d.Slot:c;return(0,e.jsx)(h,{...g,ref:b})});return f.displayName=`Primitive.${c}`,{...a,[c]:f}},{});function g(a,b){a&&c.flushSync(()=>a.dispatchEvent(b))}a.s(["Primitive",()=>f,"dispatchDiscreteCustomEvent",()=>g])},25775,a=>{"use strict";var b=a.i(25831),c=globalThis?.document?b.useLayoutEffect:()=>{};a.s(["useLayoutEffect",()=>c])},62856,a=>{"use strict";var b=a.i(25831),c=a.i(31010),d=a.i(25775),e=a=>{var e;let g,h,{present:i,children:j}=a,k=function(a){var c,e;let[g,h]=b.useState(),i=b.useRef({}),j=b.useRef(a),k=b.useRef("none"),[l,m]=(c=a?"mounted":"unmounted",e={mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}},b.useReducer((a,b)=>e[a][b]??a,c));return b.useEffect(()=>{let a=f(i.current);k.current="mounted"===l?a:"none"},[l]),(0,d.useLayoutEffect)(()=>{let b=i.current,c=j.current;if(c!==a){let d=k.current,e=f(b);a?m("MOUNT"):"none"===e||b?.display==="none"?m("UNMOUNT"):c&&d!==e?m("ANIMATION_OUT"):m("UNMOUNT"),j.current=a}},[a,m]),(0,d.useLayoutEffect)(()=>{if(g){let a,b=g.ownerDocument.defaultView??window,c=c=>{let d=f(i.current).includes(c.animationName);if(c.target===g&&d&&(m("ANIMATION_END"),!j.current)){let c=g.style.animationFillMode;g.style.animationFillMode="forwards",a=b.setTimeout(()=>{"forwards"===g.style.animationFillMode&&(g.style.animationFillMode=c)})}},d=a=>{a.target===g&&(k.current=f(i.current))};return g.addEventListener("animationstart",d),g.addEventListener("animationcancel",c),g.addEventListener("animationend",c),()=>{b.clearTimeout(a),g.removeEventListener("animationstart",d),g.removeEventListener("animationcancel",c),g.removeEventListener("animationend",c)}}m("ANIMATION_END")},[g,m]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:b.useCallback(a=>{a&&(i.current=getComputedStyle(a)),h(a)},[])}}(i),l="function"==typeof j?j({present:k.isPresent}):b.Children.only(j),m=(0,c.useComposedRefs)(k.ref,(e=l,(h=(g=Object.getOwnPropertyDescriptor(e.props,"ref")?.get)&&"isReactWarning"in g&&g.isReactWarning)?e.ref:(h=(g=Object.getOwnPropertyDescriptor(e,"ref")?.get)&&"isReactWarning"in g&&g.isReactWarning)?e.props.ref:e.props.ref||e.ref));return"function"==typeof j||k.isPresent?b.cloneElement(l,{ref:m}):null};function f(a){return a?.animationName||"none"}e.displayName="Presence",a.s(["Presence",()=>e])},49336,a=>{"use strict";var b=a.i(25831),c=a.i(73232);function d(a,e=[]){let f=[],g=()=>{let c=f.map(a=>b.createContext(a));return function(d){let e=d?.[a]||c;return b.useMemo(()=>({[`__scope${a}`]:{...d,[a]:e}}),[d,e])}};return g.scopeName=a,[function(d,e){let g=b.createContext(e),h=f.length;f=[...f,e];let i=d=>{let{scope:e,children:f,...i}=d,j=e?.[a]?.[h]||g,k=b.useMemo(()=>i,Object.values(i));return(0,c.jsx)(j.Provider,{value:k,children:f})};return i.displayName=d+"Provider",[i,function(c,f){let i=f?.[a]?.[h]||g,j=b.useContext(i);if(j)return j;if(void 0!==e)return e;throw Error(`\`${c}\` must be used within \`${d}\``)}]},function(...a){let c=a[0];if(1===a.length)return c;let d=()=>{let d=a.map(a=>({useScope:a(),scopeName:a.scopeName}));return function(a){let e=d.reduce((b,{useScope:c,scopeName:d})=>{let e=c(a)[`__scope${d}`];return{...b,...e}},{});return b.useMemo(()=>({[`__scope${c.scopeName}`]:e}),[e])}};return d.scopeName=c.scopeName,d}(g,...e)]}a.s(["createContextScope",()=>d])},47319,a=>{"use strict";var b=a.i(25831);function c(a){let c=b.useRef(a);return b.useEffect(()=>{c.current=a}),b.useMemo(()=>(...a)=>c.current?.(...a),[])}a.s(["useCallbackRef",()=>c])},19165,a=>{"use strict";var b=a.i(25831);a.i(73232);var c=b.createContext(void 0);function d(a){let d=b.useContext(c);return a||d||"ltr"}a.s(["useDirection",()=>d])},38032,a=>{"use strict";function b(a,c,{checkForDefaultPrevented:d=!0}={}){return function(b){if(a?.(b),!1===d||!b.defaultPrevented)return c?.(b)}}a.s(["composeEventHandlers",()=>b])},91586,a=>{"use strict";var b=a.i(25831),c=a.i(25775),d=b["useId".toString()]||(()=>void 0),e=0;function f(a){let[f,g]=b.useState(d());return(0,c.useLayoutEffect)(()=>{a||g(a=>a??String(e++))},[a]),a||(f?`radix-${f}`:"")}a.s(["useId",()=>f])},90869,a=>{"use strict";var b=a.i(25831),c=a.i(47319);function d({prop:a,defaultProp:d,onChange:e=()=>{}}){let[f,g]=function({defaultProp:a,onChange:d}){let e=b.useState(a),[f]=e,g=b.useRef(f),h=(0,c.useCallbackRef)(d);return b.useEffect(()=>{g.current!==f&&(h(f),g.current=f)},[f,g,h]),e}({defaultProp:d,onChange:e}),h=void 0!==a,i=h?a:f,j=(0,c.useCallbackRef)(e);return[i,b.useCallback(b=>{if(h){let c="function"==typeof b?b(a):b;c!==a&&j(c)}else g(b)},[h,a,g,j])]}a.s(["useControllableState",()=>d])},79854,a=>{"use strict";let b=(0,a.i(61313).default)("book-open",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]);a.s(["BookOpen",()=>b],79854)},43122,a=>{"use strict";var b=a.i(25831),c=a.i(73232);function d(a,e=[]){let f=[],g=()=>{let c=f.map(a=>b.createContext(a));return function(d){let e=d?.[a]||c;return b.useMemo(()=>({[`__scope${a}`]:{...d,[a]:e}}),[d,e])}};return g.scopeName=a,[function(d,e){let g=b.createContext(e),h=f.length;f=[...f,e];let i=d=>{let{scope:e,children:f,...i}=d,j=e?.[a]?.[h]||g,k=b.useMemo(()=>i,Object.values(i));return(0,c.jsx)(j.Provider,{value:k,children:f})};return i.displayName=d+"Provider",[i,function(c,f){let i=f?.[a]?.[h]||g,j=b.useContext(i);if(j)return j;if(void 0!==e)return e;throw Error(`\`${c}\` must be used within \`${d}\``)}]},function(...a){let c=a[0];if(1===a.length)return c;let d=()=>{let d=a.map(a=>({useScope:a(),scopeName:a.scopeName}));return function(a){let e=d.reduce((b,{useScope:c,scopeName:d})=>{let e=c(a)[`__scope${d}`];return{...b,...e}},{});return b.useMemo(()=>({[`__scope${c.scopeName}`]:e}),[e])}};return d.scopeName=c.scopeName,d}(g,...e)]}a.s(["createContextScope",()=>d])},88093,a=>{"use strict";let b=(0,a.i(61313).default)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);a.s(["default",()=>b])},79823,57380,a=>{"use strict";var b,c,d=a.i(82011);a.i(45763);var e=((b={}).USER="user",b.PREMIUM="premium",b.ADMIN="admin",b);(c={}).ACTIVE="active",c.INACTIVE="inactive",c.SUSPENDED="suspended",c.PENDING="pending";let f={isAdmin:a=>"admin"===a.role,isPremium:a=>["premium","admin"].includes(a.role),canCreateBooks:a=>a.is_active&&"active"===a.status,maxBooksAllowed:a=>({user:5,premium:50,admin:999999})[a.role]||5};function g(){let a=(0,d.useAuthContext)();if(!a)throw Error("useAuth must be used within an AuthProvider");let{user:b}=a,c=b?{...b,isAdmin:f.isAdmin(b),isPremium:f.isPremium(b),canCreateBooks:f.canCreateBooks(b),maxBooksAllowed:f.maxBooksAllowed(b)}:null;return{...a,user:c}}function h(){let{user:a,isAuthenticated:b}=g();return{canCreateBooks:a?.canCreateBooks||!1,canEditBooks:a?.canCreateBooks||!1,canDeleteBooks:a?.canCreateBooks||!1,canGeneratePDF:b,canAccessAdmin:a?.isAdmin||!1,canAccessPremium:a?.isPremium||!1,hasReachedBookLimit:!!a&&(a.books_count||0)>=(a.maxBooksAllowed||0)}}a.s(["UserRole",()=>e,"userHelpers",0,f],57380),a.s(["useAuth",()=>g,"usePermissions",()=>h],79823)},54161,a=>{"use strict";var b=a.i(73232),c=a.i(74264),d=a.i(42261),e=a.i(97895);let f=(0,d.cva)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function g({className:a,variant:d,asChild:g=!1,...h}){let i=g?c.Slot:"span";return(0,b.jsx)(i,{"data-slot":"badge",className:(0,e.cn)(f({variant:d}),a),...h})}a.s(["Badge",()=>g])},38747,80648,a=>{"use strict";let b=(0,a.i(61313).default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);a.s(["Search",()=>b],38747);var c=a.i(25831),d=a.i(79823),e=a.i(53250),f=a.i(56916);class g{ws=null;url;reconnectAttempts=0;maxReconnectAttempts=5;reconnectDelay=1e3;pingInterval=null;isConnecting=!1;messageHandlers=new Map;isAuthenticated=!1;constructor(){const a=process.env.NEXT_PUBLIC_API_URL?.replace("http://","").replace("https://","")||"localhost:8000";this.url=`ws://${a}/api/v1/websocket/ws`}connect(){return new Promise((a,b)=>{if(this.ws?.readyState===WebSocket.OPEN||this.isConnecting)return void a();this.isConnecting=!0;let c=(0,e.getAuthToken)();if(!c){this.isConnecting=!1,b(Error("No authentication token available"));return}try{let d=`${this.url}?token=${encodeURIComponent(c)}`;this.ws=new WebSocket(d),this.ws.onopen=()=>{console.log("WebSocket connected"),this.isConnecting=!1,this.isAuthenticated=!0,this.reconnectAttempts=0,this.startPingInterval(),a()},this.ws.onmessage=a=>{try{let b=JSON.parse(a.data);this.handleMessage(b)}catch(a){console.error("Error parsing WebSocket message:",a)}},this.ws.onclose=a=>{if(console.log("WebSocket closed:",a.code,a.reason),this.isConnecting=!1,this.isAuthenticated=!1,this.stopPingInterval(),4001===a.code){console.error("WebSocket authentication failed"),b(Error("Authentication failed"));return}this.reconnectAttempts<this.maxReconnectAttempts?this.scheduleReconnect():b(Error("Max reconnection attempts reached"))},this.ws.onerror=a=>{console.error("WebSocket error:",a),this.isConnecting=!1,0===this.reconnectAttempts&&b(a)}}catch(a){this.isConnecting=!1,b(a)}})}disconnect(){this.stopPingInterval(),this.ws&&(this.ws.close(),this.ws=null),this.isAuthenticated=!1,this.messageHandlers.clear()}scheduleReconnect(){setTimeout(()=>{this.reconnectAttempts++,console.log(`Attempting to reconnect (${this.reconnectAttempts}/${this.maxReconnectAttempts})...`),this.connect().catch(a=>{console.error("Reconnection failed:",a)})},this.reconnectDelay*Math.pow(2,this.reconnectAttempts))}startPingInterval(){this.stopPingInterval(),this.pingInterval=setInterval(()=>{this.ws?.readyState===WebSocket.OPEN&&this.send({type:"ping"})},3e4)}stopPingInterval(){this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=null)}send(a){this.ws?.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify(a))}handleMessage(a){let{type:b}=a;switch(b){case"connection_established":console.log("WebSocket connection established:",a.data);break;case"pong":break;case"ping":this.send({type:"pong"});break;case"book_generation_update":this.handleBookGenerationUpdate(a);break;case"notification":this.handleNotification(a);break;case"system_notification":this.handleSystemNotification(a)}let c=this.messageHandlers.get(b);c&&c.forEach(b=>{try{b(a)}catch(a){console.error("Error in message handler:",a)}});let d=this.messageHandlers.get("*");d&&d.forEach(b=>{try{b(a)}catch(a){console.error("Error in wildcard message handler:",a)}})}handleBookGenerationUpdate(a){let{data:b}=a;"completed"===b.status?f.toast.success(`Livro gerado com sucesso! ðŸŽ‰`,{description:b.message,action:{label:"Ver livro",onClick:()=>{}}}):"failed"===b.status&&f.toast.error("Erro na geraÃ§Ã£o do livro",{description:b.message})}handleNotification(a){let{data:b}=a,c={description:b.message};switch(b.action_url&&(c.action={label:"Ver",onClick:()=>{}}),b.type){case"success":f.toast.success(b.title,c);break;case"warning":f.toast.warning(b.title,c);break;case"error":f.toast.error(b.title,c);break;default:f.toast.info(b.title,c)}}handleSystemNotification(a){let{data:b}=a;f.toast.warning(b.title,{description:b.message,duration:1e4})}subscribe(a,b){return this.messageHandlers.has(a)||this.messageHandlers.set(a,new Set),this.messageHandlers.get(a).add(b),()=>{let c=this.messageHandlers.get(a);c&&(c.delete(b),0===c.size&&this.messageHandlers.delete(a))}}subscribeToBookUpdates(a){this.ws?.readyState===WebSocket.OPEN&&this.send({type:"subscribe_book_updates",book_id:a})}get isConnected(){return this.ws?.readyState===WebSocket.OPEN&&this.isAuthenticated}get connectionState(){if(!this.ws)return"disconnected";switch(this.ws.readyState){case WebSocket.CONNECTING:return"connecting";case WebSocket.OPEN:return this.isAuthenticated?"connected":"authenticating";case WebSocket.CLOSING:return"closing";case WebSocket.CLOSED:return"disconnected";default:return"unknown"}}}let h=new g;function i(){let{isAuthenticated:a,user:b}=(0,d.useAuth)(),[e,f]=(0,c.useState)(!1),[g,i]=(0,c.useState)("disconnected"),j=(0,c.useRef)(!1);return(0,c.useEffect)(()=>{let a=()=>{f(h.isConnected),i(h.connectionState)};a();let b=setInterval(a,1e3);return()=>clearInterval(b)},[]),(0,c.useEffect)(()=>{a&&b&&!j.current?(j.current=!0,h.connect().then(()=>{console.log("WebSocket connected for user:",b.email)}).catch(a=>{console.error("Failed to connect WebSocket:",a),j.current=!1})):!a&&h.isConnected&&(h.disconnect(),j.current=!1)},[a,b]),(0,c.useEffect)(()=>()=>{h.isConnected&&h.disconnect()},[]),{isConnected:e,connectionState:g,subscribe:(0,c.useCallback)((a,b)=>h.subscribe(a,b),[]),subscribeToBookUpdates:(0,c.useCallback)(a=>{h.subscribeToBookUpdates(a)},[])}}a.s(["useWebSocket",()=>i],80648)},87729,a=>{"use strict";let b=(0,a.i(61313).default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);a.s(["Plus",()=>b],87729)}];

//# sourceMappingURL=_6d60b317._.js.map